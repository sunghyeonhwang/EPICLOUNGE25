<?
include_once "../common.php";
include_once "member_header.php";


if($_SESSION["CI"] == ""){
    echo "<script>alert('본인 인증이 필요합니다.');location.href=\"application_step1.html\";</script>";
    exit;
}

$_SESSION["mode"] = "pay";
//$_SESSION["mode"] = "free";



function isMobileDevice() {
    $userAgent = $_SERVER['HTTP_USER_AGENT'];
    $mobileDevices = array('Android', 'iPhone', 'iPad', 'Windows Phone');

    foreach ($mobileDevices as $device) {
        if (stripos($userAgent, $device) !== false) {
            return true;
        }
    }

    return false;
}

if (isMobileDevice()) {
    $device_check = "mobile";
} else {
    $device_check = "pc";
}



$birthdate = $_SESSION["RSLT_BIRTHDAY"];
$currentDate = date('Y-m-d');
$age = date_diff(date_create($birthdate), date_create($currentDate))->y;
if($age < 18){
    echo "<script>alert('18세 이상만 신청이 가능합니다.');location.href=\"index.html\";</script>";
    exit;

}


$ci = $_SESSION["CI"];

$mysqli = new mysqli("localhost","unrealengine","Good121930!@","unrealengine");
$sql = "select count(*) from cb_unreal_2024_event2_apply where apply_ci = '$ci' and apply_temp_yn = 'N' limit 1";
$result = $mysqli -> query($sql);
$obj = $result -> fetch_array();
if($obj[0]['count']){
    echo '<script type="text/javascript">';
    echo " alert('이미 등록되어 있습니다.'); location.href='index.html';";
    echo '</script>';
    exit();
};
?>
<?php

require_once('./inisis_pc/libs/INIStdPayUtil.php');
$SignatureUtil = new INIStdPayUtil();

$mid 			= "MOIepiclou";  								// 상점아이디
$signKey 		= "Wno0S3hIQVhUZ1BKSHFYMXRIVUJpQT09"; 			// 웹 결제 signkey

//$mid 			= "INIpayTest";  								// 상점아이디
//$signKey 		= "SU5JTElURV9UUklQTEVERVNfS0VZU1RS"; 			// 웹 결제 signkey

$mKey 	= $SignatureUtil->makeHash($signKey, "sha256");

$timestamp 		= $SignatureUtil->getTimestamp();   			// util에 의해서 자동생성
$use_chkfake	= "Y";											// PC결제 보안강화 사용 ["Y" 고정]
$orderNumber 	= $mid . "_" . $timestamp; 						// 가맹점 주문번호(가맹점에서 직접 설정)


$temp_data = sql_fetch("select * from cb_unreal_2024_event2_apply where apply_ci = '$ci' order by apply_no desc  limit 1");
$coupon_data = sql_fetch("select * from cb_unreal_2024_event2_coupon where coupon_key = '".$temp_data["apply_coupon_no"]."' and usage_date is null");

//$_REQUEST["apply_product_price"] = 1000 ;

$apply_product_code = $_REQUEST["apply_product_code"];
if($apply_product_code == ""){
    $apply_product_code = $temp_data["apply_product_code"];
}
$apply_product_name = $_REQUEST["apply_product_name"];
if($apply_product_name == ""){
    $apply_product_name = $temp_data["apply_product_name"];
}

$apply_product_price = $_REQUEST["apply_product_price"];
if($apply_product_price == ""){
    $apply_product_price = $temp_data["apply_product_price"];
}

if($apply_product_code == ""){
    alert("잘못된 접근입니다.","application_step1.html");
}
if($apply_product_price == ""){
    alert("잘못된 접근입니다.","application_step1.html");
}
if($apply_product_name == ""){
    alert("잘못된 접근입니다.","application_step1.html");
}



if(strpos($apply_product_code,"STD")  !== false){
    alert("잘못된 접근입니다.","application_step1.html");
}else if(strpos($apply_product_code,"NORMAL")  !== false){
    //alert("잘못된 접근입니다.","application_step1.html");
}




if($coupon_data) {
    //$product_code = "STD_ALL";
    $apply_product_price = $apply_product_price  - $apply_product_price * ($coupon_data["discount_rate"] / 100);
}


//$_REQUEST["apply_product_price"] = 1000;
$price 			= $apply_product_price;        								// 상품가격(특수기호 제외, 가맹점에서 직접 설정)
$product_name = $apply_product_name;
//$price 			= "210000";        								// 상품가격(특수기호 제외, 가맹점에서 직접 설정)

$params = array(
    "oid" => $orderNumber,
    "price" => $price,
    "timestamp" => $timestamp
);

$sign   = $SignatureUtil->makeSignature($params);

$params = array(
    "oid" => $orderNumber,
    "price" => $price,
    "signKey" => $signKey,
    "timestamp" => $timestamp
);

$sign2   = $SignatureUtil->makeSignature($params);






?>

<!--테스트 JS--><!--<script language="javascript" type="text/javascript" src="https://stgstdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script>-->
<!--운영 JS--> <script language="javascript" type="text/javascript" src="https://stdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script>
<style>
    /* 스피너 스타일 */
    #spinner {
        display: none; /* 초기에는 숨김 */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        text-align: center;
    }
    #spinner img {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
    }
</style>


<script type="text/javascript">
    document.getElementById('header_list_2').className = "active";

    //	var body = document.body;
    //	body.classList.add("modal_on");

</script>
<div class="memeber_container">
   <div class="wrap">
   
   
   <div class="ticket_list_box mt_120">
       <ul>
           <li class="ticket_type1">
               <input type="radio" <?=$apply_product_code == "NORMAL_ALL" ? 'checked="checked"' : ''?> disabled class="" id="ticket_list_1" name="ticket_list_">
               <label for="ticket_list_1">
               <span class="ticket_title">일반 양일권</span>
               <span class="price_box">
                   <span class="text_1">120,000원</span>
                   <span class="text_2">60,000<em>원</em></span>
               </span>
               </label>
           </li>
           <li class="ticket_type1">
               <input type="radio"  <?=$apply_product_code == "NORMAL_28" ? 'checked="checked"' : ''?> disabled class="" id="ticket_list_2" name="ticket_list_">
               <label for="ticket_list_2">
               <span class="ticket_title">일반 28일권</span>
               <span class="price_box">
                   <span class="text_1">60,000원</span>
                   <span class="text_2">30,000<em>원</em></span>
               </span>
               </label>
           </li>
           <li class="ticket_type1">
               <input type="radio"  <?=$apply_product_code == "NORMAL_29" ? 'checked="checked"' : ''?> disabled class="" id="ticket_list_3" name="ticket_list_">
               <label for="ticket_list_3">
               <span class="ticket_title">일반 29일권</span>
               <span class="price_box">
   
                   <span class="text_1">60,000원</span>
                   <span class="text_2">30,000<em>원</em></span>
               </span>
               </label>
           </li>
           
       </ul>
   </div>
        <form name="frm" method="post" action="">
            <fieldset>
                <input type="hidden" name="apply_product_name" id="apply_product_name" value="<?=$apply_product_name?>" />
                <input type="hidden" name="apply_product_price" id="apply_product_price" value="<?=$apply_product_price?>" />
                <input type="hidden" name="apply_product_code" id="apply_product_code" value="<?=$apply_product_code?>" />
                <input type="hidden" name="apply_coupon_no" id="apply_coupon_no" value="<?=$temp_data["apply_coupon_no"]?>" />
                <input type="hidden" name="discount" id="discount" value="<?=$coupon_data["discount_rate"]?>" />


                <input type="hidden" name="apply_track" id="apply_track" value="쿠폰" />

                <h3 class="h3 mt_100">기본 정보</h3>
                <div class="member_form_box">
                    <div class="member_form_list">
                        <label for="apply_user_name">이름</label>
                        <input type="text" class="intext" name="apply_user_name" id="apply_user_name" placeholder="본인 인증 이름" value="<?=$_SESSION["RSLT_NAME"]?>" readonly  />
                    </div>
                    <div class="member_form_list">
                        <label for="apply_user_email">이메일<em class="em_red">*</em></label>
                        <input type="text" class="intext" name="apply_user_email" id="apply_user_email" value="<?=$temp_data["apply_user_email"]?>"   required placeholder="이메일을 정확히 입력해 주세요." />
                    </div>

                    <div class="member_form_list">
                        <label for="apply_user_phone">연락처<em class="em_red">*</em></label>
                        <input type="text" class="intext" name="apply_user_phone" id="apply_user_phone" value="<?=$_SESSION["TEL_NO"]?>"  placeholder="본인 인증 휴대전화" />
                    </div>
                </div>
                <span class="bd_line"></span>


                <h3 class="h3">추가 정보</h3>
                <div class="member_form_box">
                    <div class="member_form_list">
                        <label for="apply_user_company">직장명<em class="em_red">*</em></label>
                        <input type="text" class="intext" name="apply_user_company" id="apply_user_company" value="<?=$temp_data["apply_user_company"]?>"   required placeholder="회사명을 입력해 주세요." />
                    </div>
                    <div class="member_form_list">
                        <label for="apply_user_depart">부서<em class="em_red">*</em></label>
                        <input type="text" class="intext" name="apply_user_depart" id="apply_user_depart" value="<?=$temp_data["apply_user_depart"]?>"   required placeholder="부서명을 입력해 주세요." />
                    </div>

                    <div class="member_form_list">
                        <label for="apply_user_grade">직무<em class="em_red">*</em></label>
                        <select name="apply_user_grade" id="apply_user_grade">
                            <option value=''>선택</option>
                            <option <?=$temp_data["apply_user_grade"] == "비주얼아트"?"selected='selected'":""?>>비주얼아트</option>
                            <option <?=$temp_data["apply_user_grade"] == "프로그래밍"?"selected='selected'":""?>>프로그래밍</option>
                            <option <?=$temp_data["apply_user_grade"] == "프로덕션"?"selected='selected'":""?>>프로덕션</option>
                            <option <?=$temp_data["apply_user_grade"] == "엔지니어링"?"selected='selected'":""?>>엔지니어링</option>
                            <option <?=$temp_data["apply_user_grade"] == "설계"?"selected='selected'":""?>>설계</option>
                            <option <?=$temp_data["apply_user_grade"] == "기획"?"selected='selected'":""?>>기획</option>
                            <option <?=$temp_data["apply_user_grade"] == "R&D"?"selected='selected'":""?>>R&D</option>
                            <option <?=$temp_data["apply_user_grade"] == "IT"?"selected='selected'":""?>>IT</option>
                            <option <?=$temp_data["apply_user_grade"] == "감독/PD"?"selected='selected'":""?>>감독/PD</option>
                            <option <?=$temp_data["apply_user_grade"] == "비즈니스/마케팅"?"selected='selected'":""?>>비즈니스/마케팅</option>
                            <option <?=$temp_data["apply_user_grade"] == "C-level"?"selected='selected'":""?>>C-level</option>
                            <option <?=$temp_data["apply_user_grade"] == "기타"?"selected='selected'":""?>>기타</option>
                        </select>
                    </div>
                    <div class="member_form_list">
                        <label for="apply_user_ex1">산업/관심 분야<em class="em_red">*</em></label>
                        <select class="insel" name="apply_user_ex1" id="apply_user_ex1" required>
                            <option value='' <?=$temp_data["apply_user_ex1"] == "" ? "selected=true":""?>>관심 분야를 선택해 주세요.</option>
                            <option <?=$temp_data["apply_user_ex1"] == "게임" ? "selected='selected'" : ""?>>게임</option>
                            <option <?=$temp_data["apply_user_ex1"] == "건축" ? "selected='selected'" : ""?>>건축</option>
                            <option <?=$temp_data["apply_user_ex1"] == "자동차&운송" ? "selected='selected'" : ""?>>자동차&amp;운송</option>
                            <option <?=$temp_data["apply_user_ex1"] == "영화&TV" ? "selected='selected'" : ""?>>영화&amp;TV</option>
                            <option <?=$temp_data["apply_user_ex1"] == "방송&라이브 이벤트" ? "selected='selected'" : ""?>>방송&amp;라이브 이벤트</option>
                            <option <?=$temp_data["apply_user_ex1"] == "애니메이션" ? "selected='selected'" : ""?>>애니메이션</option>
                            <option <?=$temp_data["apply_user_ex1"] == "제조" ? "selected='selected'" : ""?>>제조</option>
                            <option <?=$temp_data["apply_user_ex1"] == "소프트웨어&툴 개발" ? "selected='selected'" : ""?>>소프트웨어&amp;툴 개발</option>
                            <option <?=$temp_data["apply_user_ex1"] == "VR/AR" ? "selected='selected'" : ""?>>VR/AR</option>
                            <option <?=$temp_data["apply_user_ex1"] == "교육" ? "selected='selected'" : ""?>>교육</option>
                            <option <?=$temp_data["apply_user_ex1"] == "기타" ? "selected='selected'" : ""?>>기타</option>
                        </select>
                        <script>
                            $(document).ready(function() {
                                // Select the element using the class selector
                                var select = $('.insel');

                                // Apply the placeholder class to the first option
                                select.addClass('placeholder');

                                // Remove the placeholder class when the select element is focused
                                select.on('focus', function() {
                                    $(this).removeClass('placeholder');
                                });

                                // Listen for change events
                                select.on('change', function() {
                                    if ($(this).val() === '') {
                                        $(this).addClass('placeholder');
                                    } else {
                                        $(this).removeClass('placeholder');
                                    }
                                });


                                $("#agree_all").click(function() {
                                    var checkedStatus = this.checked;
                                    $("input[id^='agree_se']").each(function() {
                                        this.checked = checkedStatus;
                                    });
                                });

                                $("input[id^='agree_se']").click(function() {
                                    if (!this.checked) {
                                        $("#agree_all").prop('checked', false);
                                    } else {
                                        var allChecked = true;
                                        $("input[id^='agree_se']").each(function() {
                                            if (!this.checked) {
                                                allChecked = false;
                                            }
                                        });
                                        $("#agree_all").prop('checked', allChecked);
                                    }
                                });
                            });
                        </script>
                    </div>
                </div>
                <span class="bd_line"></span>

                <h3 class="h3"><em class="em_yellow">할인 쿠폰</em>&nbsp;정보 입력</h3>
                <div class="member_form_box ">
                    <div class="member_form_list coupon_form">
                        <label for="apply_user_coupon" class="none">쿠폰 번호<em class="em_red">*</em></label>
                        <? if($coupon_data){?>
                            <input type="text" class="intext" name="apply_user_coupon" id="apply_user_coupon" value="<?=$coupon_data["coupon_serial"]?>"  disabled  required placeholder="쿠폰 번호를 입력해 주세요." />
                        <?}else{?>
                            <input type="text" class="intext" name="apply_user_coupon" id="apply_user_coupon" value=""   required placeholder="쿠폰 번호를 입력해 주세요." /><button type="button" class="coupon_btn" onclick="coupon_view()">확인</button>
                        <?}?>
                    </div>
                </div>

                <span class="bd_line"></span>



                <?
                //약관동의  include
                include_once "agree_include.php";
                ?>

                <div class="ft_btn_box">
                    <?

                    if($device_check=="pc"){
                        ?>
                        <input type="button" onclick="on_pay_pc()"  name="" id="" class="btn_1" value="결제하기" />
                        <?
                    }else{
                        ?>
                        <input type="button" onclick="on_pay()"  name="" id="" class="btn_1" value="결제하기" />
                        <?
                    }
                    ?>
                </div>
            </fieldset>
        </form>
    </div>
</div>





<script>
    function on_pay() {

        if($("#agree_se1").is(":checked") == false){
            alert("이용약관에 동의해 주세요.");
            return;
        }
        if($("#agree_se2").is(":checked") == false){
            alert("개인정보 이용 동의서에 동의해 주세요.");
            return;
        }
        if($("#agree_se3").is(":checked") == false){
            alert("개인정보 제 3자 제공에 대한 동의서에 동의해 주세요.");
            return;
        }


        if($("#apply_user_email").val() == ""){
            alert("이메일을 입력해주세요.");
            return;
        }
        if($("#apply_user_phone").val() == ""){
            alert("연락처를 입력해주세요.");
            return;
        }
        if($("#apply_coupon_no").val() == ""){
            alert("쿠폰 번호를 확인해주세요.");
            return;
        }

        if($("#apply_user_company").val() == ""){
            alert("직장명을 입력해주세요.");
            return;
        }
        if($("#apply_user_depart").val() == ""){
            alert("부서를 입력해주세요.");
            return;
        }
        if($("#apply_user_grade").val() == ""){
            alert("직무를 입력해주세요.");
            return;
        }
        if($("#apply_user_ex1").val() == ""){
            alert("산업/관심 분야를 입력해주세요");
            return;
        }

        $("#spinner").show();
        $.ajax({
            type: "POST",
            url: "/v3/unrealfest2024/_applicaiton_coupon_pay_ajax.php",
            data: {
                apply_user_name: $("#apply_user_name").val(),
                agree_se4: $("#agree_se4").prop("checked"),
                apply_user_email:  $("#apply_user_email").val(),
                apply_user_phone:  $("#apply_user_phone").val(),
                apply_user_company:  $("#apply_user_company").val(),
                apply_user_depart:  $("#apply_user_depart").val(),
                apply_user_grade:  $("#apply_user_grade").val(),
                apply_user_ex1:  $("#apply_user_ex1").val(),
                apply_product_name:  $("#apply_product_name").val(),
                apply_product_price: $("#apply_product_price").val(),
                apply_product_code: $("#apply_product_code").val(),
                apply_track: $("#apply_track").val(),
                apply_coupon_no: $("#apply_coupon_no").val(),
            },
            success: function (data) {
                if(data == "중복된 신청입니다."){
                    alert("중복된 신청입니다");
                    return;
                }else{
                    var discount = $("#discount").val();
                    var price = $("#apply_product_price").val();
                    var sale_price = (price - (price * discount / 100)).toFixed(0);

                    if(sale_price == 0){
                        $.ajax({
                            type: "POST",
                            url: "/v3/unrealfest2024/_applicaiton_pay_free_ajax.php",
                            data: {
                            },
                            success: function (data) {
                                location.href='/v3/unrealfest2024/application_step3_offline.html'
                            },
                            complete: function () {
                                $("#spinner").hide();
                            }
                        });
                    }else{

                        //$("#mo_apply_product_price").val(sale_price);
                        //$("#pc_apply_product_price").val(sale_price);

                        $("input[name=P_INI_PAYMENT]").val("CARD");
                        myform = document.mobileweb;
                        myform.action = "https://mobile.inicis.com/smart/payment/";
                        myform.target = "_self";
                        myform.submit();
                    }
                }
            },
            complete: function () {
                // 요청 완료 시 스피너 숨기기
                $("#spinner").hide();
            }
        });
    }
    function on_pay_pc() {

        if($("#agree_se1").is(":checked") == false){
            alert("이용약관에 동의해 주세요.");
            return;
        }
        if($("#agree_se2").is(":checked") == false){
            alert("개인정보 이용 동의서에 동의해 주세요.");
            return;
        }
        if($("#agree_se3").is(":checked") == false){
            alert("개인정보 제 3자 제공에 대한 동의서에 동의해 주세요.");
            return;
        }


        if($("#apply_user_email").val() == ""){
            alert("이메일을 입력해주세요.");
            return;
        }
        if($("#apply_user_phone").val() == ""){
            alert("연락처를 입력해주세요.");
            return;
        }
        if($("#apply_coupon_no").val() == ""){
            alert("쿠폰 번호를 확인해주세요.");
            return;
        }

        if($("#apply_user_company").val() == ""){
            alert("직장명을 입력해주세요.");
            return;
        }
        if($("#apply_user_depart").val() == ""){
            alert("부서를 입력해주세요.");
            return;
        }
        if($("#apply_user_grade").val() == ""){
            alert("직무를 입력해주세요.");
            return;
        }
        if($("#apply_user_ex1").val() == ""){
            alert("산업/관심 분야를 입력해주세요");
            return;
        }

        $("#P_MOBILE").val($("#apply_user_phone").val());
        $("#P_EMAIL").val($("#apply_user_email").val());

        $("#buyertel").val($("#apply_user_phone").val());
        $("#buyeremail").val($("#apply_user_email").val());




        $("#spinner").show();
        $.ajax({
            type: "POST",
            url: "/v3/unrealfest2024/_applicaiton_coupon_pay_ajax.php",
            data: {
                apply_user_name: $("#apply_user_name").val(),
                agree_se4: $("#agree_se4").prop("checked"),
                apply_user_email:  $("#apply_user_email").val(),
                apply_user_phone:  $("#apply_user_phone").val(),
                apply_user_company:  $("#apply_user_company").val(),
                apply_user_depart:  $("#apply_user_depart").val(),
                apply_user_grade:  $("#apply_user_grade").val(),
                apply_user_ex1:  $("#apply_user_ex1").val(),
                apply_product_name:  $("#apply_product_name").val(),
                apply_product_price: $("#apply_product_price").val(),
                apply_product_code: $("#apply_product_code").val(),
                apply_track: $("#apply_track").val(),
                apply_coupon_no: $("#apply_coupon_no").val(),
            },
            success: function (data) {

                if(data == "중복된 신청입니다."){
                    alert("중복된 신청입니다");
                    return;
                }else{

                    var discount = $("#discount").val();
                    var price = $("#apply_product_price").val();
                    var sale_price = (price - (price * discount / 100)).toFixed(0);

                    //$("#mo_apply_product_price").val(sale_price);
                    //$("#pc_apply_product_price").val(sale_price);

                    if(sale_price == 0){
                        $.ajax({
                            type: "POST",
                            url: "/v3/unrealfest2024/_applicaiton_pay_free_ajax.php",
                            data: {
                            },
                            success: function (data) {
                                location.href='/v3/unrealfest2024/application_step3_offline.html'
                            },
                            complete: function () {
                                $("#spinner").hide();
                            }
                        });
                    }else{
                        var paymethod = "CARD";
                        if(paymethod == "CARD"){
                            $("input[name=gopaymethod]").val("Card");
                        }else if(paymethod == "KAKAOPAY"){
                            $("input[name=gopaymethod]").val("Card");
                        }else if(paymethod == "NAVERPAY"){
                            $("input[name=gopaymethod]").val("Card");
                        }else if(paymethod == "VBANK"){
                            $("input[name=gopaymethod]").val("vbank");
                        }
                        INIStdPay.pay('SendPayForm_id');
                    }
                }
            },
            complete: function () {
                // 요청 완료 시 스피너 숨기기
                $("#spinner").hide();
            }
        });
    }
</script>



<form name="mobileweb" id="" method="post" class="mt-5" accept-charset="euc-kr" style="display: none">
    <div class="row g-3 justify-content-between" style="--bs-gutter-x:0rem;">

        <label class="col-10 col-sm-2 input param" style="border:none;">P_INI_PAYMENT</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_INI_PAYMENT" value="CARD">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_MID</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_MID" value="MOIepiclou">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_OID</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_OID" value="<?=$orderNumber?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_AMT</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_AMT" id="mo_apply_product_price" value="<?=$price?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_GOODS</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_GOODS" value="<?=$product_name?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_UNAME</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_UNAME" value="<?=$_SESSION["RSLT_NAME"]?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">P_MOBILE</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_MOBILE" id="P_MOBILE" value="<?=$_SESSION["TEL_NO"]?>">
        </label>
        <label class="col-10 col-sm-2 input param" style="border:none;">P_EMAIL</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_EMAIL" id="P_EMAIL" value="<?=$_POST['inputEmail']?>">
        </label>

        <input type="hidden" name="P_NEXT_URL" value="https://epiclounge.co.kr/v3/unrealfest2024/inisis/INImobile_mo_return.php">
        <input type="hidden" name="P_NOTI_URL" value="https://epiclounge.co.kr/v3/unrealfest2024/inisis/vbank_succ.php">

        <input type="hidden" name="P_CHARSET" value="utf8">

        <label class="col-10 col-sm-2 input param" style="border:none;">P_RESERVED</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="P_RESERVED" value="below1000=Y&vbank_receipt=Y&centerCd=Y">
        </label>

    </div>
</form>



<form name="SendPayForm_id" id="SendPayForm_id" method="post" class="mt-5" style="display: none">
    <div class="row g-3 justify-content-between" style="--bs-gutter-x:0rem;">
        <input type="hidden" name="version" value="1.0">
        <!--/label-->

        <label class="col-10 col-sm-2 input param" style="border:none;">gopaymethod</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="gopaymethod" value="Card:Directbank:vbank">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">mid</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="mid" value="<?php echo $mid ?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">oid</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="oid" value="<?php echo $orderNumber ?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">price</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="price" id="pc_apply_product_price"  value="<?php echo $price ?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">timestamp</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="timestamp" value="<?php echo $timestamp ?>">
        </label>


        <input type="hidden" name="use_chkfake" value="<?php echo $use_chkfake ?>">
        <input type="hidden" name="signature" value="<?php echo $sign ?>">
        <input type="hidden" name="verification" value="<?php echo $sign2 ?>">
        <input type="hidden" name="mKey" value="<?php echo $mKey ?>">
        <input type="hidden" name="currency" value="WON">


        <label class="col-10 col-sm-2 input param" style="border:none;">goodname</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="goodname" value="<?=$product_name?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">buyername</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="buyername" value="<?=$_SESSION["RSLT_NAME"]?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">buyertel</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="buyertel" id="buyertel"  value="<?=$_SESSION["TEL_NO"]?>">
        </label>

        <label class="col-10 col-sm-2 input param" style="border:none;">buyeremail</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="buyeremail" id="buyeremail" value="<?=$_POST['inputEmail']?>">
        </label>

        <input type="hidden" name="returnUrl" value="https://epiclounge.co.kr/v3/unrealfest2024/inisis_pc/INIstdpay_pc_return.php">
        <input type="hidden" name="closeUrl" value="https://epiclounge.co.kr/v3/unrealfest2024/inisis_pc/close.php">

        <label class="col-10 col-sm-2 input param" style="border:none;">acceptmethod</label>
        <label class="col-10 col-sm-9 input">
            <input type="text" name="acceptmethod" value="HPP(1):below1000:centerCd(Y)">
        </label>

    </div>
</form>


<!-- 트랙이 가득차있을경우 body에 modal_on 클래스  -->
<div class="member_modal member_modal1">
    <div class="modal_wrap">
        <div class="modal_box">
            <p class="text_1">쿠폰이 확인되었습니다.</p>
            <p class="text_2" id="coupon_pan"> </p>
            <div class="btn_box">
                <a href="#n" class="btn_1" onclick="coupon_reload()">쿠폰적용하기</a>
                <a href="#n" class="btn_2">닫기</a>
            </div>
        </div>
    </div>
</div>

<!-- 트랙이 가득차있을경우 body에 modal_on 클래스  -->
<div class="member_modal member_modal2">
    <div class="modal_wrap">
        <div class="modal_box">
            <p class="text_1" id="pan_msg">정상적인 쿠폰 번호를 입력해주세요</p>
            <div class="btn_box">
                <a href="#n" class="btn_2">닫기</a>
            </div>
        </div>
    </div>
</div>
<script>
    function coupon_reload(){
        $.ajax({
            type: "POST",
            url: "/v3/unrealfest2024/_applicaiton_coupon_pay_ajax.php",
            data: {
                apply_user_name: $("#apply_user_name").val(),
                agree_se4: $("#agree_se4").prop("checked"),
                apply_user_email:  $("#apply_user_email").val(),
                apply_user_phone:  $("#apply_user_phone").val(),
                apply_user_company:  $("#apply_user_company").val(),
                apply_user_depart:  $("#apply_user_depart").val(),
                apply_user_grade:  $("#apply_user_grade").val(),
                apply_user_ex1:  $("#apply_user_ex1").val(),
                apply_product_name:  $("#apply_product_name").val(),
                apply_product_price: $("#apply_product_price").val(),
                apply_product_code: $("#apply_product_code").val(),
                apply_track: $("#apply_track").val(),
                apply_coupon_no: $("#apply_coupon_no").val(),
            },
            success: function (data) {

                if(data == "중복된 신청입니다."){
                    alert("중복된 신청입니다");
                    return;
                }else{
                    location.reload();
                }
            },
            complete: function () {
                // 요청 완료 시 스피너 숨기기
                $("#spinner").hide();
            }
        });
    }
    function coupon_view(){

        $("#apply_coupon_no").val("");

        $.ajax({
            type: "POST",
            url: "/v3/unrealfest2024/_applicaiton_ajax_coupon.php",
            data: {
                apply_user_coupon: $("#apply_user_coupon").val(),
                apply_product_code: $("#apply_product_code").val()
            },
            success: function (data) {
                if(data === "잘못된 접근입니다."){
                    $(".member_modal2").show();
                    $('body').addClass('modal_on');
                    $("#pan_msg").html(data);
                    return;
                }else if(data === "존재하지 않는 쿠폰입니다."){
                    $(".member_modal2").show();
                    $('body').addClass('modal_on');
                    $("#pan_msg").html(data);
                    return;
                }else if(data === "이미 사용된 쿠폰입니다.") {
                    $(".member_modal2").show();
                    $('body').addClass('modal_on');
                    $("#pan_msg").html(data);
                    return;
                }else{
                    var price = $("#apply_product_price").val();
                    $(".member_modal").hide();
                    $(".member_modal1").show();
                    $('body').addClass('modal_on');

                    var parts = data.split('_');
                    var discount = parts[0];
                    var coupon_key = parts[1];
                    $("#coupon_pan").html("쿠폰 할인율 : "+discount+"% (<strike>"+price+"</strike> -> "+(price - (price * discount / 100))+")");
                    $("#discount").val(discount);
                    $("#apply_coupon_no").val(coupon_key);
                }
            },
            complete: function () {
                // 요청 완료 시 스피너 숨기기
                $("#spinner").hide();
            }
        });





    }
    $(document).ready(function() {
        $('.btn_2').on('click', function() {
            $('body').removeClass('modal_on');
            $(".member_modal").hide();
        });
    });
</script>

<!-- 스피너 요소 -->
<div id="spinner" style="display: none;">
    <img src="img/spinner.gif" alt="Loading...">
</div>
</body>

</html>
